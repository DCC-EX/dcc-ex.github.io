

<!DOCTYPE html>
<html class="writer-html5" lang="en" >
<head>
  <meta charset="utf-8" />
  
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  
  <title>High Accuracy Waveform Mode &mdash; DCC++ EX  documentation</title>
  

  
  <link rel="stylesheet" href="../_static/css/theme.css" type="text/css" />
  <link rel="stylesheet" href="../_static/pygments.css" type="text/css" />
  <link rel="stylesheet" href="../_static/css/dccex_theme.css" type="text/css" />

  
  

  
  

  

  
  <!--[if lt IE 9]>
    <script src="../_static/js/html5shiv.min.js"></script>
  <![endif]-->
  
    
      <script type="text/javascript" id="documentation_options" data-url_root="../" src="../_static/documentation_options.js"></script>
        <script src="../_static/jquery.js"></script>
        <script src="../_static/underscore.js"></script>
        <script src="../_static/doctools.js"></script>
        <script src="../_static/js/platform.js"></script>
        <script src="../_static/js/extra.js"></script>
    
    <script type="text/javascript" src="../_static/js/theme.js"></script>

    
    <link rel="index" title="Index" href="../genindex.html" />
    <link rel="search" title="Search" href="../search.html" />
    <link rel="next" title="Throttles" href="../throttles/index.html" />
    <link rel="prev" title="Mega+WiFi Configuration" href="wifi-mega.html" /> 
</head>

<body class="wy-body-for-nav">

   
  <div class="wy-grid-for-nav">
    
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-scroll">
        <div class="wy-side-nav-search"  style="background: white" >
          

          
            <a href="../index.html">
          

          
            
            <img src="../_static/logo.png" class="logo" alt="Logo"/>
          
          </a>

          
            
            
          

          
<div role="search">
  <form id="rtd-search-form" class="wy-form" action="../search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" />
    <input type="hidden" name="check_keywords" value="yes" />
    <input type="hidden" name="area" value="default" />
  </form>
</div>

          
        </div>

        
        <div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="main navigation">
          
            
            
              
            
            
              <ul class="current">
<li class="toctree-l1"><a class="reference internal" href="../get-started/index.html">Get Started</a></li>
<li class="toctree-l1 current"><a class="reference internal" href="index.html">Advanced Setup</a><ul class="current">
<li class="toctree-l2"><a class="reference internal" href="wifi-config.html">Wifi Configuration</a></li>
<li class="toctree-l2"><a class="reference internal" href="motor-board-config.html">Motor Board Configuration</a></li>
<li class="toctree-l2"><a class="reference internal" href="IBT_2-motor-board-setup.html">IBT_2 BTS7960 Motor Board</a></li>
<li class="toctree-l2"><a class="reference internal" href="L298N-motor-board-setup.html">L298N Motor Board Setup</a></li>
<li class="toctree-l2"><a class="reference internal" href="wifi-mega.html">Mega+WiFi Configuration</a></li>
<li class="toctree-l2 current"><a class="current reference internal" href="#">High Accuracy Waveform Mode</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="../throttles/index.html">Throttles</a></li>
<li class="toctree-l1"><a class="reference internal" href="../reference/index.html">Reference</a></li>
<li class="toctree-l1"><a class="reference internal" href="../download/index.html">Downloads</a></li>
<li class="toctree-l1"><a class="reference internal" href="../contributing/index.html">Contributing</a></li>
<li class="toctree-l1"><a class="reference internal" href="../support/index.html">Support</a></li>
<li class="toctree-l1"><a class="reference internal" href="../about/index.html">About</a></li>
</ul>

            
          
        </div>
        
      </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap">

      
      <nav class="wy-nav-top" aria-label="top navigation">
        
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="../index.html">DCC++ EX</a>
        
      </nav>


      <div class="wy-nav-content">
        
        <div class="rst-content">
        
          

















<div role="navigation" aria-label="breadcrumbs navigation">

  <ul class="wy-breadcrumbs">
    
      <li><a href="../index.html" class="icon icon-home"></a> &raquo;</li>
        
          <li><a href="index.html">Advanced Setup</a> &raquo;</li>
        
      <li>High Accuracy Waveform Mode</li>
    
    
      <li class="wy-breadcrumbs-aside">
        
          
            <a href="../_sources/advanced-setup/high-accuracy.rst.txt" rel="nofollow"> View page source</a>
          
        
      </li>
    
  </ul>

  
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
           <div itemprop="articleBody">
            
  <div class="section" id="high-accuracy-waveform-mode">
<h1>High Accuracy Waveform Mode<a class="headerlink" href="#high-accuracy-waveform-mode" title="Permalink to this headline">¶</a></h1>
<p><strong>Engineers Only</strong></p>
<p>Do you need it? Most likely, you don’t. But if you run into a problem with a particular decoder and all the usual settings don’t help, you may want to try this mode. We have found that some older decoders do not adhere to the NMRA specification tolerances. They can fail to read bits that are within the proper range. While rare, this could occur. The High Accuracy mode makes the waveform, the pulse train of 1’s and 0’s, even tighter to the nominal values in the specification.</p>
<p>The nominal spec asks for 58us 1 bits and 100us 0 bits with a few microseconds leeway in either direction. We opted to use 116us 0 bits since it is exactly twice a 1 bit and made it easy for us to use one timer to generate both bits. On occasion, with all the other things going on inside the command station, and the way we use timers and interrupts in normal accuracy mode, it is possible for there also to be a little jitter. That’s when the bit durations from bit to bit can vary a few microseconds. High Accuracy Mode uses the hardware timers instead of just our software routine, to tighten up any jitter.</p>
<p>For this to work, you need two things:</p>
<ul class="simple">
<li><p>The signal pin for the track you want to have high accuracy must be a Timer1 pin</p></li>
<li><p>You must use the single signal pin configuration for your motor board</p></li>
</ul>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>You do not have to do anything to enable High Accuracy Waveform Mode. If your motor board config meets the above two criterion, it will be enabled automatically and report that in the serial monitor boot log.</p>
</div>
<div class="section" id="the-motor-board-config">
<h2>The Motor Board Config<a class="headerlink" href="#the-motor-board-config" title="Permalink to this headline">¶</a></h2>
<p>You will notice that your motor driver type is set in the <em>config.h</em> file. This line sets a standard motor shield compatible with the Arduino Motor Shield:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="c1">#define MOTOR_SHIELD_TYPE STANDARD_MOTOR_SHIELD</span>
</pre></div>
</div>
<p>Whether called Motor “boards” or “shields” or “drivers”, they are defined in the <em>MotorDrivers.h</em> file and look like this:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="c1">#define STANDARD_MOTOR_SHIELD F(&quot;STANDARD_MOTOR_SHIELD&quot;), \</span>
<span class="n">new</span> <span class="n">MotorDriver</span><span class="p">(</span><span class="mi">3</span><span class="p">,</span> <span class="mi">12</span><span class="p">,</span> <span class="n">UNUSED_PIN</span><span class="p">,</span> <span class="n">UNUSED_PIN</span><span class="p">,</span> <span class="n">A0</span><span class="p">,</span> <span class="mf">2.99</span><span class="p">,</span> <span class="mi">2000</span><span class="p">,</span> <span class="n">UNUSED_PIN</span><span class="p">),</span> \
<span class="n">new</span> <span class="n">MotorDriver</span><span class="p">(</span><span class="mi">11</span><span class="p">,</span> <span class="mi">13</span><span class="p">,</span> <span class="n">UNUSED_PIN</span><span class="p">,</span> <span class="n">UNUSED_PIN</span><span class="p">,</span> <span class="n">A1</span><span class="p">,</span> <span class="mf">2.99</span><span class="p">,</span> <span class="mi">2000</span><span class="p">,</span> <span class="n">UNUSED_PIN</span><span class="p">)</span>
</pre></div>
</div>
<p>The first line after setting the name and display text is for the Main track and the next line is for the programming track. The parameters are as follows:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">MotorDriver</span><span class="p">(</span><span class="n">power_pin</span><span class="p">,</span> <span class="n">signal_pin</span><span class="p">,</span> <span class="n">signal_pin2</span><span class="p">,</span> <span class="n">brake_pin</span><span class="p">,</span> <span class="n">current_pin</span><span class="p">,</span> <span class="n">senseFactor</span><span class="p">,</span> <span class="n">tripMilliamps</span><span class="p">,</span> <span class="n">faultPin</span><span class="p">)</span>
</pre></div>
</div>
<p>Therefore, the second and third parameters are the signal pins. Some boards have 2 direction pins (ex: IBT_2 Motor Driver Board). These are sometimes labelled CW and CCW for clockwise and counter-clockwise. If you want to use two pins so that you don’t need a transister or integrated circuit inverter, then you can’t use the high accuracy waveform.</p>
<p>If you have a board with a single DIR input, or wish to make the simple 1 transistor and 2 resistor inverter circuit described <strong>*TODO: Enter link here*</strong>, you can use the high accuracy mode.</p>
<p>You must choose signal pins from the following list for your Arduino:</p>
<p>Mega - 11, 12 and 12
Uno - 9 and 10
Nano - 9 and 10</p>
<p>By luck, two of the Mega pins associated with Timer 1 are directly under the DIRA and DIRB pins of an Arduino Motor Shield or pin compatible shield; pins 12 and 13. Therefore, the combination of a Mega and this shield will automatically use high accuracy for both tracks.</p>
<p>However, an Uno’s pins do not line up with this shield. In order to use high accuracy mode, you would have to change the signal pin assignements and use a jumper wire.</p>
<p><strong>*TODO: put description here*</strong></p>
<p><strong>*TODO: put description of creating a motor board type here or link to another section if I did it already*</strong></p>
</div>
</div>


           </div>
           
          </div>
          <footer>
    <div class="rst-footer-buttons" role="navigation" aria-label="footer navigation">
        <a href="../throttles/index.html" class="btn btn-neutral float-right" title="Throttles" accesskey="n" rel="next">Next <span class="fa fa-arrow-circle-right" aria-hidden="true"></span></a>
        <a href="wifi-mega.html" class="btn btn-neutral float-left" title="Mega+WiFi Configuration" accesskey="p" rel="prev"><span class="fa fa-arrow-circle-left" aria-hidden="true"></span> Previous</a>
    </div>

  <hr/>

  <div role="contentinfo">
    <p>
        &#169; Copyright 2020, Dave Cutting, Fred Decker, Mani Kumar, Matt H.

    </p>
  </div>
    
    
    
    Built with <a href="https://www.sphinx-doc.org/">Sphinx</a> using a
    
    <a href="https://github.com/readthedocs/sphinx_rtd_theme">theme</a>
    
    provided by <a href="https://readthedocs.org">Read the Docs</a>. 

</footer>
        </div>
      </div>

    </section>

  </div>
  

  <script type="text/javascript">
      jQuery(function () {
          SphinxRtdTheme.Navigation.enable(true);
      });
  </script>

  
  
    
   

</body>
</html>