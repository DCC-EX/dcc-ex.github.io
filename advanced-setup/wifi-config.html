

<!DOCTYPE html>
<html class="writer-html5" lang="en" >
<head>
  <meta charset="utf-8" />
  
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  
  <title>Wifi Configuration &mdash; DCC++ EX  documentation</title>
  

  
  <link rel="stylesheet" href="../_static/css/theme.css" type="text/css" />
  <link rel="stylesheet" href="../_static/pygments.css" type="text/css" />
  <link rel="stylesheet" href="../_static/css/dccex_theme.css" type="text/css" />

  
  

  
  

  

  
  <!--[if lt IE 9]>
    <script src="../_static/js/html5shiv.min.js"></script>
  <![endif]-->
  
    
      <script type="text/javascript" id="documentation_options" data-url_root="../" src="../_static/documentation_options.js"></script>
        <script src="../_static/jquery.js"></script>
        <script src="../_static/underscore.js"></script>
        <script src="../_static/doctools.js"></script>
        <script src="../_static/js/platform.js"></script>
        <script src="../_static/js/extra.js"></script>
    
    <script type="text/javascript" src="../_static/js/theme.js"></script>

    
    <link rel="index" title="Index" href="../genindex.html" />
    <link rel="search" title="Search" href="../search.html" />
    <link rel="next" title="Motor Board Configuration" href="motor-board-config.html" />
    <link rel="prev" title="Advanced Setup" href="index.html" /> 
</head>

<body class="wy-body-for-nav">

   
  <div class="wy-grid-for-nav">
    
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-scroll">
        <div class="wy-side-nav-search"  style="background: white" >
          

          
            <a href="../index.html">
          

          
            
            <img src="../_static/logo.png" class="logo" alt="Logo"/>
          
          </a>

          
            
            
          

          
<div role="search">
  <form id="rtd-search-form" class="wy-form" action="../search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" />
    <input type="hidden" name="check_keywords" value="yes" />
    <input type="hidden" name="area" value="default" />
  </form>
</div>

          
        </div>

        
        <div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="main navigation">
          
            
            
              
            
            
              <ul class="current">
<li class="toctree-l1"><a class="reference internal" href="../get-started/index.html">Get Started</a></li>
<li class="toctree-l1 current"><a class="reference internal" href="index.html">Advanced Setup</a><ul class="current">
<li class="toctree-l2 current"><a class="current reference internal" href="#">Wifi Configuration</a></li>
<li class="toctree-l2"><a class="reference internal" href="motor-board-config.html">Motor Board Configuration</a></li>
<li class="toctree-l2"><a class="reference internal" href="IBT_2-motor-board-setup.html">IBT_2 BTS7960 Motor Board</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="../throttles/index.html">Throttles</a></li>
<li class="toctree-l1"><a class="reference internal" href="../reference/index.html">Reference</a></li>
<li class="toctree-l1"><a class="reference internal" href="../download/index.html">Downloads</a></li>
<li class="toctree-l1"><a class="reference internal" href="../contributing/index.html">Contributing</a></li>
<li class="toctree-l1"><a class="reference internal" href="../support/index.html">Support</a></li>
<li class="toctree-l1"><a class="reference internal" href="../about/index.html">About</a></li>
</ul>

            
          
        </div>
        
      </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap">

      
      <nav class="wy-nav-top" aria-label="top navigation">
        
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="../index.html">DCC++ EX</a>
        
      </nav>


      <div class="wy-nav-content">
        
        <div class="rst-content">
        
          

















<div role="navigation" aria-label="breadcrumbs navigation">

  <ul class="wy-breadcrumbs">
    
      <li><a href="../index.html" class="icon icon-home"></a> &raquo;</li>
        
          <li><a href="index.html">Advanced Setup</a> &raquo;</li>
        
      <li>Wifi Configuration</li>
    
    
      <li class="wy-breadcrumbs-aside">
        
          
            <a href="../_sources/advanced-setup/wifi-config.rst.txt" rel="nofollow"> View page source</a>
          
        
      </li>
    
  </ul>

  
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
           <div itemprop="articleBody">
            
  <div class="section" id="wifi-configuration">
<h1>Wifi Configuration<a class="headerlink" href="#wifi-configuration" title="Permalink to this headline">¶</a></h1>
<p><strong>work in progress</strong></p>
<p>This page describes the software configuration options for using WiFi to connect your Command Station wirelessly to JMRI or a WiFi throttle like Engine Driver. For information on how to connect your hardware, go to <a class="reference external" href="../get-started/wifi-setup.html">WiFi Setup</a></p>
<p>For a video click <a class="reference external" href="https://www.youtube.com/watch?v=N6TWR7fIl0A&amp;t=5s">Setting up WiFi</a></p>
<blockquote>
<div><iframe width="336" height="189" src="https://www.youtube.com/embed/N6TWR7fIl0A" frameborder="0" allow="accelerometer; autoplay; clipboard-write; encrypted-media; gyroscope; picture-in-picture" allowfullscreen></iframe></div></blockquote>
<div class="section" id="wireless-connections">
<h2>Wireless Connections<a class="headerlink" href="#wireless-connections" title="Permalink to this headline">¶</a></h2>
<p>As mentioned in <a class="reference external" href="../get-started/wifi-setup.html">WiFi Setup</a>, there are two main reasons for wanting to use WiFi; to connect to JMRI without a USB cable, or to connect to a WiThrottle controller like the Engine Driver mobile app. In addition, you have two options for connecting your WiThrottle Controller to your Command Station. If you are using JMRI, you can leave your CS connected to the JMRI computer via the USB cable and connect your Controller via WiFi to the WiThrottle server running on the JMRI computer. If you don’t need JMRI or just want to connect your WiFi Controller directly to the CS, then you connect to the WiThrottle Server running on your CS.</p>
</div>
<div class="section" id="what-s-a-withrottle-server">
<h2>What’s a “WiThrottle Server”?<a class="headerlink" href="#what-s-a-withrottle-server" title="Permalink to this headline">¶</a></h2>
<p>WiThrottle stands for “WiFi Throttle” and a “WiThrottle Server” is just software running on your JMRI computer or on the DCC-EX Command Station. It’s called a “server” because it allows you to connect to it and it “serves” or services requests from another application. That application is called a “Client”. So your throttle in this case is the client.</p>
<p>WiThrottle itself is a standard for how WiFi throttles can communicate with Command Stations much like the DCC standard is a standard for how data packets are communicate to decoders. What this means for you, is that any device that is WiThrottle compatible should work with DCC-EX.</p>
</div>
<div class="section" id="ap-mode-vs-station-mode">
<h2>AP Mode vs. Station Mode<a class="headerlink" href="#ap-mode-vs-station-mode" title="Permalink to this headline">¶</a></h2>
<p>There are two ways to setup the Wifi chip connected to DCC++: “Access Point Mode” (aka “AP MODE) and “Station Mode”. We often abbreviate the latter to “STA”. You will also see people refer to it as “Client Mode”.</p>
<p>In AP mode the tiny ESP chip acts as a very basic Wifi server and provides a small IP network for your throttle or for your computer running JMRI and WiThrottle.</p>
<p>In STA (Client) mode the ESP chip uses an existing (home) Wifi network and connects to that along with all the other devices you might have in your home. If you have a stable Wifi network where you place your Command Station and you would rather have one network with your router to manage it all, you can configure this option.</p>
<p>We will focus on how to connect a Throttle to the Command Station. For info on using WiFi with JMRI, click here <strong>missing link</strong></p>
<p>Only you can decide which is the best type of connection for your system.</p>
<div class="section" id="ap-mode">
<h3>AP Mode<a class="headerlink" href="#ap-mode" title="Permalink to this headline">¶</a></h3>
<p>If there is no previously configured network in range or the Wifi setup in your config.h file is still unconfigured, the default for DCC-EX is AP mode. In this mode, your CS acts like an AP. In other words, it acts just like any other wireless router you could connect to. The router in your home is in effect, an AP. Using the CS in AP mode allows you to have a separate network so you can keep your layout network separate from your home network. This is the simplest way to enable a way for a throttle to connect to your CS. Other than making sure ENABLE_WIFI is set to true in your config.h file, there is nothing else to do.</p>
<p>In this mode there is no connection to the Internet for any of the devices that are only connected to the AP. It simply provides a private network to allow a direct connection to your throttles.</p>
<p>If you travel to shows or take your setup to a friend’s house, this allows for an autonomous, transportable system that does not need a connection to and hopefully will not interfere with, other networks. See <strong>dealing with interference (missing link)</strong></p>
</div>
<div class="section" id="station-mode-sta-mode">
<h3>Station Mode (STA Mode)<a class="headerlink" href="#station-mode-sta-mode" title="Permalink to this headline">¶</a></h3>
<p>Station mode allows you to connect the Command Station to your existing home network. The CS becomes a Station or Client rather than an AP. That means instead of being an AP which manages the IP of the smartphone that contains your Throttle, it becomes a station that connects to your existing network just like any of the other computers or devices connected to your network. The Throttle connects to the CS by finding its IP address on the network. You will have to know how to go into your router settings or use the commands on your computer to find what IP address is assigned to the CS. Alternately, you can define a static IP address in your router to assign to the CS.</p>
</div>
</div>
<div class="section" id="wifi-config-options">
<h2>WiFi Config Options<a class="headerlink" href="#wifi-config-options" title="Permalink to this headline">¶</a></h2>
<p>The following defines are all the possible network settings found the config.h file. If you used the automated installer, you may see a few of these already listed. If you do a manual Arduino IDE install, you will see all of these in the file you renamed from “config.example.h” to “config.h”.</p>
<div class="line-block">
<div class="line"><a class="reference internal" href="#define-ip-port-2560"><span class="std std-ref">#define IP_PORT 2560</span></a></div>
<div class="line"><a class="reference internal" href="#define-enable-wifi-true"><span class="std std-ref">#define ENABLE_WIFI true</span></a></div>
<div class="line"><a class="reference internal" href="#define-dont-touch-wifi-conf"><span class="std std-ref">#define DONT_TOUCH_WIFI_CONF</span></a></div>
<div class="line"><a class="reference internal" href="#define-wifi-ssid-your-network-name"><span class="std std-ref">#define WIFI_SSID “Your network name”</span></a></div>
<div class="line"><a class="reference internal" href="#define-wifi-password-your-network-passwd"><span class="std std-ref">#define WIFI_PASSWORD “Your network passwd”</span></a></div>
<div class="line"><a class="reference internal" href="#define-wifi-hostname-dccex"><span class="std std-ref">#define WIFI_HOSTNAME “dccex”</span></a></div>
<div class="line"><a class="reference internal" href="#define-wifi-connect-timeout-14000"><span class="std std-ref">#define WIFI_CONNECT_TIMEOUT 14000</span></a></div>
<div class="line"><a class="reference internal" href="#define-enable-ethernet-true"><span class="std std-ref">#define ENABLE_ETHERNET true</span></a></div>
<div class="line"><a class="reference internal" href="#define-ip-address-192-168-1-200"><span class="std std-ref">#define IP_ADDRESS { 192, 168, 1, 200 }</span></a></div>
<div class="line"><a class="reference internal" href="#define-mac-address-0xde-0xad-0xbe-0xef-0xfe-0xef"><span class="std std-ref">#define MAC_ADDRESS {  0xDE, 0xAD, 0xBE, 0xEF, 0xFE, 0xEF }</span></a></div>
</div>
<div class="section" id="define-ip-port-2560">
<h3>#define IP_PORT 2560<a class="headerlink" href="#define-ip-port-2560" title="Permalink to this headline">¶</a></h3>
<p><strong>Default: 2560</strong> - This is the port used to communicate with the WiFi board or Ethernet Shield. We use the default value of 2560 because that is the port JMRI uses. You can change this value if you would prefer it to be something else. You will need to enter this in sofware like Engine Driver in order to connect to the CS via networking.</p>
</div>
<div class="section" id="define-enable-wifi-true">
<h3>#define ENABLE_WIFI true<a class="headerlink" href="#define-enable-wifi-true" title="Permalink to this headline">¶</a></h3>
<p><strong>Default: true</strong> - WiFi is supported only on a Mega. If you do not wish to use WiFi and want to save boot time by not having the Mega check for a WiFi board each time, you may set this to “false”</p>
</div>
<div class="section" id="define-dont-touch-wifi-conf">
<h3>#define DONT_TOUCH_WIFI_CONF<a class="headerlink" href="#define-dont-touch-wifi-conf" title="Permalink to this headline">¶</a></h3>
<p><strong>Default: commented out</strong> If uncommented, this tells the CS to NOT process any WiFi commands in the CS. If other WiFi defines are enabled, the CS will ignore them. With this command, you can leave #define ENABLE_WIFI true so that networking is active, but send no configuration commands to ESP8266. This allows you to enter your own AT commands to set up your Wifi however you want. To do this, you would enter &lt;+&gt; commands in the serial monitor or add code to send these commands automatically.</p>
</div>
<div class="section" id="define-wifi-ssid-your-network-name">
<h3>#define WIFI_SSID “Your network name”<a class="headerlink" href="#define-wifi-ssid-your-network-name" title="Permalink to this headline">¶</a></h3>
<p><strong>Default: “Your network name”</strong> - To connect to your CS as an AP (Access Point), do not change this setting. If you wish to connect to your home network instead, enter the SSID (network name) for that network. If you do NOT set the WIFI_SSID, the WiFi chip will first try to connect to the previously configured network and if that fails fall back to Access Point mode. The SSID of the AP will be automatically set to DCCEX_xxxxxx, where xxxxxx is the last 6 digits of the MAC address for the WiFi chip.
Your SSID may not contain <code class="docutils literal notranslate"><span class="pre">&quot;</span></code> (double quote, ASCII 0x22).</p>
</div>
<div class="section" id="define-wifi-password-your-network-passwd">
<h3>#define WIFI_PASSWORD “Your network passwd”<a class="headerlink" href="#define-wifi-password-your-network-passwd" title="Permalink to this headline">¶</a></h3>
<p><strong>Default: “Your network passwd”</strong> - WIFI_PASSWORD is the network password for your home network or if you want to change the password from default AP mode password to the AP password you want. If you don’t change this setting and start up in AP mode, the default password is PASS_xxxxxx where xxxxxx is the last 6 digits of the MAX address for your ESP board.
Your password may not conain <code class="docutils literal notranslate"><span class="pre">&quot;</span></code> (double quote, ASCII 0x22).</p>
</div>
<div class="section" id="define-wifi-hostname-dccex">
<h3>#define WIFI_HOSTNAME “dccex”<a class="headerlink" href="#define-wifi-hostname-dccex" title="Permalink to this headline">¶</a></h3>
<p><strong>Default: “dccex”</strong> You would normally not want to change this, it is the host name that will appear in the list of available networks that a device you want to connect to DCC-EX will display. It helps you know which device is your Command Station.</p>
</div>
<div class="section" id="define-wifi-connect-timeout-14000">
<h3>#define WIFI_CONNECT_TIMEOUT 14000<a class="headerlink" href="#define-wifi-connect-timeout-14000" title="Permalink to this headline">¶</a></h3>
<p><strong>Default: 14000 milliseconds (14 seconds)</strong> - You only need to set this if you have an extremely slow Wifi router and the response to the connection request takes longer than normal.</p>
</div>
<div class="section" id="define-enable-ethernet-true">
<h3>#define ENABLE_ETHERNET true<a class="headerlink" href="#define-enable-ethernet-true" title="Permalink to this headline">¶</a></h3>
<p><strong>Default: commented out</strong> - Uncomment this line if you with to use an Ethernet Shield (not WiFi, see above for tha). You will also need to install the Arduino Ethernet Library on whatever development environment you use to compile and upload your sketch.</p>
</div>
<div class="section" id="define-ip-address-192-168-1-200">
<h3>#define IP_ADDRESS { 192, 168, 1, 200 }<a class="headerlink" href="#define-ip-address-192-168-1-200" title="Permalink to this headline">¶</a></h3>
<p><strong>Default: commented out</strong> - Uncomment this line if you wish to use a static IP address, otherwise the CS will use DHCP to automatcally assign an IP address from your router. If you use a static IP, you will also have to configure this on your router.</p>
</div>
<div class="section" id="define-mac-address-0xde-0xad-0xbe-0xef-0xfe-0xef">
<h3>#define MAC_ADDRESS {  0xDE, 0xAD, 0xBE, 0xEF, 0xFE, 0xEF }<a class="headerlink" href="#define-mac-address-0xde-0xad-0xbe-0xef-0xfe-0xef" title="Permalink to this headline">¶</a></h3>
<p><strong>Default: commented out</strong> - This is for Ethernet only! Ethernet shields do not normally come with a defined MAC address. We give you two and you can uncomment the one you prefer. You can also choose any other validly formatted MAC address that will not conflict with any devices already on your network.</p>
</div>
</div>
<div class="section" id="default-operation-ap-mode-no-configuration-necessary">
<h2>Default Operation - AP Mode (No Configuration Necessary)<a class="headerlink" href="#default-operation-ap-mode-no-configuration-necessary" title="Permalink to this headline">¶</a></h2>
<p>To use the default AP mode, you don’t have to do anything other than connect an ESP8266 board as described in <a class="reference external" href="../get-started/wifi-setup.html">WiFi Setup</a>. That’s it! We find your Wifi board, no matter which of the extra serial ports you attached it to and create a WiThrottle Server that waits for you to connect to it with software like Engine Driver.</p>
<p>You will need to know:</p>
<ul class="simple">
<li><p>The IP address assigned by the WiFi board (Usually <strong>192.168.4.1</strong>)</p></li>
<li><p>The port to communicate through. (<strong>port 2560</strong> unless you change it in your config.h file)</p></li>
<li><p>The SSID or Server name to connect to (<strong>DCCEX_xxxxxx</strong> where the x’s are the last 6 digits of your MAC</p></li>
<li><p>The password (Unless you change it in config.h, it is <strong>PASS_xxxxxx</strong> where the x’s are the last 6 digits of your MAX</p></li>
</ul>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>All of this information is displayed in the startup log if you connect the CS to a serial monitor.</p>
</div>
<p>Whenever you connect a USB cable and open the serial monitor, you reset the program running on your CS. It will go through the bootup sequence and try to connect to a network. If you did not setup a “Station Mode” configuration, or if that network is not in range, it will configure itself in AP mode. You will see this process by watching the serial monitor log window. Here are the important lines you need to look for. While the IP address is almost always 192.168.4.1, it could be different on your system. You are looking for the items in the blue box below that are highlighted in red.</p>
<a class="reference internal image-reference" href="../_images/ap_mode1.jpg"><img alt="IP Address" src="../_images/ap_mode1.jpg" style="width: 514.4px; height: 404.0px;" /></a>
<p><strong>Figure 1</strong> - Serial Monitor Log (click to enlarge)</p>
<p>You will see the line that has <code class="docutils literal notranslate"><span class="pre">AT+CIPSERVER=1,2560\r\r\nno</span> <span class="pre">change\r\n\r\nOK\r\n</span></code>, where 2560 is your port number</p>
<p>Next you will see <code class="docutils literal notranslate"><span class="pre">+CIFSR:APIP,&quot;192.168.4.1&quot;</span></code>, where your IP address is 192.168.4.1.</p>
<p>AP IP here stands for “Access Point IP Address”. Your throttle is assigned an IP in the same IP range, typically 192.168.4.10 to 15. As in this case your AP is at the same time your DCC-EX CS, you connect your throttle to the AP IP. Remember to enter it correctly into your WiFi Throttle when you configure that later.</p>
<p>You will also see your SSID and Password in the log.</p>
<p>Once you see an AP IP Address and see <code class="docutils literal notranslate"><span class="pre">`++</span> <span class="pre">Wifi</span> <span class="pre">Setup</span> <span class="pre">OK</span> <span class="pre">++</span></code> at the bottom of the log (it may take a few seconds for the CS to complete the configuration), you can connect to it. See the next section.</p>
<div class="section" id="connecting-to-the-ap">
<h3>Connecting to the AP<a class="headerlink" href="#connecting-to-the-ap" title="Permalink to this headline">¶</a></h3>
<p>There are two steps to get you running trains with your WiFi throttle, the first is to connect to the AP instead of your home network, the second is to connect your throttle to the AP.</p>
<p>On your mobile device, go into your WiFi settings that same way you would to connect to your home router. Look for another network to connect to. You should see a new network that begins with “DCCEX” like this example: <code class="docutils literal notranslate"><span class="pre">DCCEX_6e321b</span></code>. Remember those last 6 digits.</p>
<p>Simply click on that network and connect to it. You will need to enter the password you specified in the config.h file. If you did not enter one, the default will be <strong>PASS_xxxxxx</strong> where “xxxxxx” are the same last 6 digits of your device’s MAC address displayed in the SSID like this example:
<code class="docutils literal notranslate"><span class="pre">PASS_6e321b</span></code></p>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>The last 6 letters and numbers of your AP name and default password will be specific to your WiFi board and uniquely identify it. They are the last 6 letters of that device’s MAC address. You can always find it in the log or by simply looking at the DCCEX_xxxxxx SSID name in your list of available networks.</p>
</div>
<p>Ignore the warning that may popup telling you that “Internet may not be available”. The CS is not connected to the internet and you are connecting your mobile device directly to it. Depending on the config and OS of your device you may still have Internet over mobile data through a cell tower connection. If you wish to use your home network internet (for example if your data plan is expensive), turn off mobile data and see the section below on Station Mode to connect using your home network instead.</p>
<p>Once you are connected to the CS, you can run your WiFi Throttle program, enter the IP Address for the Server Address (<strong>the default is usually 192.168.4.1, but it will be displayed in your serial monitor log if you are unsure</strong>), enter <strong>2560 for the port number</strong>, and then select and acquire your loco by its address. If you don’t know your loco address, see <strong>*missing link for the &lt;R&gt; command*</strong></p>
<p><strong>Once again:</strong></p>
<p>IP Address - Normally 192.168.4.1
Port Number - 2560
Server Name - DCCEX_123456 where the last 6 characters are unique to your WiFi device
Server Password - PASS_123456 where the last 6 charaters are the same as above</p>
<p>All this information appears in the startup log if you are connected using a serial monitor in case you forget.</p>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>If you experience dropped connections to the AP, turn off the auto-connect feature on your phone to prevent it from randomly disconnecting from the AP and connecting to your home router because it thinks it’s a better connection.</p>
</div>
</div>
</div>
<div class="section" id="connecting-to-your-network-station-mode-edit-config-h">
<h2>Connecting to your Network - Station Mode (edit config.h)<a class="headerlink" href="#connecting-to-your-network-station-mode-edit-config-h" title="Permalink to this headline">¶</a></h2>
<p>In order to connect to your home network, you must open the config.h file in a text editor and enter your login credentials or you have already entered your credentials via the installer. The easiest way to do this other than the installer is to use the Arduino IDE and open the project. Look for these lines in the file:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="o">/////////////////////////////////////////////////////////////////////////////////////</span>
<span class="o">//</span>
<span class="o">//</span> <span class="n">NOTE</span><span class="p">:</span> <span class="n">Only</span> <span class="n">supported</span> <span class="n">on</span> <span class="n">Arduino</span> <span class="n">Mega</span>
<span class="o">//</span> <span class="n">Set</span> <span class="n">to</span> <span class="n">false</span> <span class="k">if</span> <span class="n">you</span> <span class="n">do</span> <span class="ow">not</span> <span class="n">want</span> <span class="n">it</span> <span class="n">even</span> <span class="n">on</span> <span class="n">the</span> <span class="n">Arduino</span> <span class="n">Mega</span>
<span class="o">//</span>
<span class="c1">#define ENABLE_WIFI true</span>

<span class="o">/////////////////////////////////////////////////////////////////////////////////////</span>
<span class="o">//</span>
<span class="o">//</span> <span class="n">DEFINE</span> <span class="n">WiFi</span> <span class="n">Parameters</span> <span class="p">(</span><span class="n">only</span> <span class="ow">in</span> <span class="n">effect</span> <span class="k">if</span> <span class="n">WIFI</span> <span class="ow">is</span> <span class="n">on</span><span class="p">)</span>
<span class="o">//</span>
<span class="c1">#define WIFI_SSID &quot;Your network name&quot;</span>
<span class="c1">#define WIFI_PASSWORD &quot;Your network passwd&quot;</span>
<span class="c1">#define WIFI_HOSTNAME &quot;dccex&quot;</span>
</pre></div>
</div>
<p>Figure 2 - Station Mode Configuration</p>
<p>First, make sure that the #define ENABLE_WIFI true line is not commented out. two slashes <code class="docutils literal notranslate"><span class="pre">//</span></code> in front of a line make it a comment and not a line of code</p>
<p>Next, enter your network information into the WIFI_SSID, WIFI_PASSORD and WIFI_HOSTNAME fields. Here is an example:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="c1">#define WIFI_SSID &quot;JonesFamily&quot;</span>
<span class="c1">#define WIFI_PASSWORD &quot;Secret!2020&quot;</span>
</pre></div>
</div>
<p>We recommend leaving WIFI_HOSTNAME to “dccex”, but you can change it if you like. If your ESP8266 WiFi board has a later version of firmware, that can allow you to connect using this name instead of the IP address. In other words, it allows that name to be an alias for the IP address.</p>
</div>
<div class="section" id="resetting-network-settings">
<h2>Resetting Network Settings<a class="headerlink" href="#resetting-network-settings" title="Permalink to this headline">¶</a></h2>
<p>Once you enter a network SSID and password, the CS will always try to connect to it, even after removing the power and restarting. If you want to connect in AP mode, or your network credentials change, or you need to connect to a different network, you simply need to tell your WiFi board to clear the settings.</p>
<p>Go into your serial monitor and wait until the CS has gone through the startup sequence. Then in command textbox enter <code class="docutils literal notranslate"><span class="pre">+CWQAP</span></code></p>
<p>and press “SEND”.</p>
<p>You will then see an “Ok” message. The WiFi Settings are forgotten. However, if the last config.h used when you uploaded it to the CS had WiFi Credentials in it, then as soon as your CS restarts, it will load and save those settings again. So…</p>
<div class="section" id="if-you-want-to-run-in-ap-mode">
<h3>If you want to run in AP mode<a class="headerlink" href="#if-you-want-to-run-in-ap-mode" title="Permalink to this headline">¶</a></h3>
<p>Edit the config.h, change your SSID name, and password lines back to default. It MUST look like the following. If it is anything else it will try to login with whatever you type there as credentials!:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="c1">#define WIFI_SSID &quot;Your network name&quot;</span>
<span class="c1">#define WIFI_PASSWORD &quot;Your network passwd&quot;</span>
</pre></div>
</div>
<p>Then upload the project into the CS</p>
</div>
<div class="section" id="if-you-want-to-change-your-network-login">
<h3>If you want to change your network login<a class="headerlink" href="#if-you-want-to-change-your-network-login" title="Permalink to this headline">¶</a></h3>
<p>Edit the config.h file, change your SSID and password to your new credentials, and then upload the project into the CS</p>
</div>
</div>
<div class="section" id="disabling-wifi">
<h2>Disabling WiFi<a class="headerlink" href="#disabling-wifi" title="Permalink to this headline">¶</a></h2>
<p>Edit the config.h file. Comment out the line <code class="docutils literal notranslate"><span class="pre">#define</span> <span class="pre">WIFI_ENABLE</span> <span class="pre">true</span></code> by adding two forward slash marks (<code class="docutils literal notranslate"><span class="pre">//</span></code>). Then upload the project back to the CS.</p>
</div>
<div class="section" id="network-startup-sequence">
<h2>Network Startup sequence<a class="headerlink" href="#network-startup-sequence" title="Permalink to this headline">¶</a></h2>
<p>For reference, it may be helpful to know the sequnce the Command Station uses to try and establish a network connection. The following provides the flow of this sequence.</p>
<ol class="arabic simple">
<li><p>Check for a WiFi Device - Scan serial ports 1, 2, and 3 in order to look for Wifi. If no response, abort network setup and start the Command Station without WiFi.</p></li>
<li><p>If we find a WiFi device, next look if <code class="docutils literal notranslate"><span class="pre">#define</span> <span class="pre">DONT_TOUCH_WIFI_CONF</span></code> is uncommented. If so, abort config attempts here - done</p></li>
<li><p>Next, IF no SSID is configured, check if the ESP is configured in STATION mode already from a previous network connection. If so, try to connect to that network. If we connect, stop and start the CS, if not, go to step 4.</p></li>
<li><p>Try to configure in STATION mode from values in the config.h file - done</p></li>
<li><p>If none of the above, set up as an AP with an ID of DCCEX_xxxxxx and a password set in the config.h file. If unconfigured, the default will be PASS_xxxxxx (xxxxxx will be the last 6 characters of the device MAC address)</p></li>
</ol>
</div>
<div class="section" id="tips-and-tricks">
<h2>Tips and Tricks<a class="headerlink" href="#tips-and-tricks" title="Permalink to this headline">¶</a></h2>
<p>There are circumstances where you may want to make temporary changes to your network, such as when you take your layout to a show. The following are some handy things you can do. Use a serial monitor connected to the USB port of your CS and enter the commands you need. Remember that if you disconnect the serial monitor and reconnect it (or anything else) to the USB port, it will reset the CS and it will go back to the default configuration. Remember to press “send” after each command.</p>
<div class="section" id="temporarily-log-into-a-different-network">
<h3>Temporarily Log Into A Different Network<a class="headerlink" href="#temporarily-log-into-a-different-network" title="Permalink to this headline">¶</a></h3>
<ol class="arabic simple">
<li><p>Forget your network settings by entering <code class="docutils literal notranslate"><span class="pre">&lt;+CWQAP&gt;</span></code></p></li>
<li><p>Login to the new network by entering</p></li>
</ol>
</div>
<div class="section" id="create-a-static-ip-for-your-cs-in-ap-mode">
<h3>Create a Static IP for your CS in AP Mode<a class="headerlink" href="#create-a-static-ip-for-your-cs-in-ap-mode" title="Permalink to this headline">¶</a></h3>
<p>You must have a recent version of the firmware to support _DEF commands. If they don’t work, try entering them without this suffix (Example: &lt;+CIPAP&gt; instead of &lt;+CIPAP_DEF&gt;)</p>
<ol class="arabic simple">
<li><p>Forget your network settings by entering &gt;+&lt;CWQP&gt;</p></li>
<li><p>Enter <code class="docutils literal notranslate"><span class="pre">&lt;+CIPAP_DEF=&quot;192.168.5.1&quot;,&quot;192.168.5.1&quot;,&quot;255.255.255.0&quot;&gt;</span></code> to setup the AP with your IP address</p></li>
<li><p>Enter <code class="docutils literal notranslate"><span class="pre">&lt;+CWDHCP_DEF=1,1&gt;</span></code></p></li>
<li><p>Enter <code class="docutils literal notranslate"><span class="pre">&lt;+CWDHCPPS_DEF=&quot;1,10,&quot;192.168.5.100&quot;,&quot;192.168.5.150&quot;&gt;</span></code></p></li>
</ol>
</div>
</div>
</div>


           </div>
           
          </div>
          <footer>
    <div class="rst-footer-buttons" role="navigation" aria-label="footer navigation">
        <a href="motor-board-config.html" class="btn btn-neutral float-right" title="Motor Board Configuration" accesskey="n" rel="next">Next <span class="fa fa-arrow-circle-right" aria-hidden="true"></span></a>
        <a href="index.html" class="btn btn-neutral float-left" title="Advanced Setup" accesskey="p" rel="prev"><span class="fa fa-arrow-circle-left" aria-hidden="true"></span> Previous</a>
    </div>

  <hr/>

  <div role="contentinfo">
    <p>
        &#169; Copyright 2020, Dave Cutting, Fred Decker, Mani Kumar, Matt H.

    </p>
  </div>
    
    
    
    Built with <a href="https://www.sphinx-doc.org/">Sphinx</a> using a
    
    <a href="https://github.com/readthedocs/sphinx_rtd_theme">theme</a>
    
    provided by <a href="https://readthedocs.org">Read the Docs</a>. 

</footer>
        </div>
      </div>

    </section>

  </div>
  

  <script type="text/javascript">
      jQuery(function () {
          SphinxRtdTheme.Navigation.enable(true);
      });
  </script>

  
  
    
   

</body>
</html>