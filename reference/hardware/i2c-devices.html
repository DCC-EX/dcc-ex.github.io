

<!DOCTYPE html>
<html class="writer-html5" lang="en" >
<head>
  <meta charset="utf-8" />
  
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  
  <title>I2C Devices &mdash; DCC++ EX  documentation</title>
  

  
  <link rel="stylesheet" href="../../_static/css/theme.css" type="text/css" />
  <link rel="stylesheet" href="../../_static/pygments.css" type="text/css" />
  <link rel="stylesheet" href="../../_static/pygments.css" type="text/css" />
  <link rel="stylesheet" href="../../_static/css/theme.css" type="text/css" />
  <link rel="stylesheet" href="../../_static/css/dccex_theme.css" type="text/css" />

  
  
    <link rel="shortcut icon" href="../../_static/favicon.ico"/>
  

  
  

  

  
  <!--[if lt IE 9]>
    <script src="../../_static/js/html5shiv.min.js"></script>
  <![endif]-->
  
    
      <script type="text/javascript" id="documentation_options" data-url_root="../../" src="../../_static/documentation_options.js"></script>
        <script data-url_root="../../" id="documentation_options" src="../../_static/documentation_options.js"></script>
        <script src="../../_static/jquery.js"></script>
        <script src="../../_static/underscore.js"></script>
        <script src="../../_static/doctools.js"></script>
        <script src="../../_static/js/platform.js"></script>
        <script src="../../_static/js/extra.js"></script>
    
    <script type="text/javascript" src="../../_static/js/theme.js"></script>

    
    <link rel="index" title="Index" href="../../genindex.html" />
    <link rel="search" title="Search" href="../../search.html" />
    <link rel="next" title="I2C GPIO Expander Modules" href="gpio-module.html" />
    <link rel="prev" title="I2C Displays" href="i2c-displays.html" /> 
</head>

<body class="wy-body-for-nav">

   
  <div class="wy-grid-for-nav">
    
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-scroll">
        <div class="wy-side-nav-search"  style="background: white" >
          

          
            <a href="../../index.html">
          

          
            
            <img src="../../_static/logo.png" class="logo" alt="Logo"/>
          
          </a>

          
            
            
          

          
<div role="search">
  <form id="rtd-search-form" class="wy-form" action="../../search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" />
    <input type="hidden" name="check_keywords" value="yes" />
    <input type="hidden" name="area" value="default" />
  </form>
</div>

          
        </div>

        
        <div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="main navigation">
          
            
            
              
            
            
              <ul class="current">
<li class="toctree-l1"><a class="reference internal" href="../../get-started/index.html">Get Started</a><ul>
<li class="toctree-l2"><a class="reference internal" href="../../get-started/levels.html">Levels</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../get-started/assembly.html">Assembly</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../get-started/wifi-setup.html">WiFi Setup</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../get-started/installer.html">Install using the Automated Installer</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../get-started/arduino-ide.html">Install using the Arduino IDE</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../get-started/controllers.html">Choosing a Controller (Throttle)</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../get-started/diagnosing-issues.html">Diagnosing Issues (Troubleshooting)</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="../../advanced-setup/index.html">Advanced Setup</a><ul>
<li class="toctree-l2"><a class="reference internal" href="../../advanced-setup/wifi-config.html">Wireless Connections</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../advanced-setup/wifi-config.html#connection-type-direct-to-command-station-or-through-jmri">Connection Type: Direct to Command Station or through JMRI</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../advanced-setup/wifi-config.html#what-s-a-withrottle-server">What’s a “WiThrottle Server”?</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../advanced-setup/wifi-config.html#access-point-mode-vs-station-mode">Access Point Mode vs. Station Mode</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../advanced-setup/wifi-config.html#default-operation-ap-mode-no-configuration-necessary">Default Operation - AP Mode (No Configuration Necessary)</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../advanced-setup/wifi-config.html#connecting-to-your-network-station-mode-sta-edit-config-h">Connecting to your Network - Station Mode “STA” (edit config.h)</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../advanced-setup/wifi-config.html#wifi-config-options">WiFi Config Options</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../advanced-setup/wifi-config.html#resetting-network-settings">Resetting Network Settings</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../advanced-setup/wifi-config.html#disabling-wifi">Disabling WiFi</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../advanced-setup/wifi-config.html#network-startup-sequence">Network Startup sequence</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../advanced-setup/wifi-config.html#tips-and-tricks">Tips and Tricks</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../advanced-setup/motor-board-config.html">Motor Board Configuration</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../advanced-setup/startup-config.html">Startup Configuration</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../advanced-setup/supported-motorboards/index.html">Supported Motorboards Setup Notes</a><ul>
<li class="toctree-l3"><a class="reference internal" href="../../advanced-setup/supported-motorboards/L298N-motor-board-setup.html">L298N Motor Board Setup</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../advanced-setup/supported-motorboards/IBT_2-motor-board-setup.html">IBT_2 BTS7960 Motor Board</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../advanced-setup/supported-motorboards/IRF3205-motor-board-setup.html">IRF3205 Motor Board Setup</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="../../advanced-setup/supported-microcontrollers/index.html">Supported Microcontrollers Setup Notes</a><ul>
<li class="toctree-l3"><a class="reference internal" href="../../advanced-setup/supported-microcontrollers/wifi-mega.html">Mega+WiFi Configuration</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../advanced-setup/supported-microcontrollers/nano.html">Arduino Nano Setup</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../advanced-setup/supported-microcontrollers/nano-every.html">Nano Every</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../advanced-setup/supported-microcontrollers/teensy.html">Teensy</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="../../advanced-setup/high-accuracy.html">High Accuracy Waveform Mode</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="../../throttles/index.html">Throttles</a><ul>
<li class="toctree-l2"><a class="reference internal" href="../../throttles/protocols.html">WiThrottle Server, Web Server, DCC++ API Explained</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../throttles/ex-webthrottle.html">DCC++ EX Web Throttle</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../throttles/engine-driver.html">Engine Driver</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../throttles/withrottle.html">WiThrottle</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../throttles/dccpp-cab.html">DCCpp CAB</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../throttles/locontrol.html">Locontrol</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../throttles/cab-engineer.html">Cab Engineer: DCC Throttle</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../throttles/digitrainspro.html">DigiTrainsPro</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../throttles/srcpclient.html">SRCP Client for iOS</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../throttles/streamdeck.html">Elgato Stream Deck</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="../../automation/index.html">Automation (EX-RAIL) BETA!</a><ul>
<li class="toctree-l2"><a class="reference internal" href="../../automation/EX-RAIL-intro.html">Introduction to EX-RAIL Automation</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../automation/EX-RAIL-ref.html">EX-RAIL Command Summary</a></li>
</ul>
</li>
<li class="toctree-l1 current"><a class="reference internal" href="../index.html">Reference</a><ul class="current">
<li class="toctree-l2 current"><a class="reference internal" href="index.html">Hardware</a><ul class="current">
<li class="toctree-l3"><a class="reference internal" href="microcontroller-boards.html">Microcontroller Boards</a></li>
<li class="toctree-l3"><a class="reference internal" href="motor-boards.html">Motor Boards</a></li>
<li class="toctree-l3"><a class="reference internal" href="wifi-boards.html">WiFi Boards</a></li>
<li class="toctree-l3"><a class="reference internal" href="ethernet-boards.html">Ethernet Boards</a></li>
<li class="toctree-l3"><a class="reference internal" href="i2c-displays.html">I2C Displays</a></li>
<li class="toctree-l3 current"><a class="current reference internal" href="#">I2C Devices</a></li>
<li class="toctree-l3"><a class="reference internal" href="gpio-module.html">I2C GPIO Expander Modules</a></li>
<li class="toctree-l3"><a class="reference internal" href="servo-module.html">Connecting a Servo Module</a></li>
<li class="toctree-l3"><a class="reference internal" href="power-supplies.html">Power Supplies</a></li>
<li class="toctree-l3"><a class="reference internal" href="accessory-controllers.html">Accessory Controllers</a></li>
<li class="toctree-l3"><a class="reference internal" href="shopping-list.html">Shopping List</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="../software/hal-config.html">I/O Device Drivers and HAL</a></li>
<li class="toctree-l2"><a class="reference internal" href="../software/hal.html">DCC++EX HAL Architecture</a></li>
<li class="toctree-l2"><a class="reference internal" href="../software/writing-hal-driver.html">Writing a HAL Driver</a></li>
<li class="toctree-l2"><a class="reference internal" href="../software/release-notes.html">Release Notes</a></li>
<li class="toctree-l2"><a class="reference internal" href="../software/command-reference.html">DCC++ EX Command Reference</a></li>
<li class="toctree-l2"><a class="reference internal" href="../software/command-summary.html">DCC++ EX Command Summary</a></li>
<li class="toctree-l2"><a class="reference internal" href="../software/diagnostic-d-ack-command.html">Diagnostics <code class="docutils literal notranslate"><span class="pre">&lt;D</span> <span class="pre">ACK&gt;</span></code> Command</a></li>
<li class="toctree-l2"><a class="reference internal" href="../software/diagnostic-d-command.html">Diagnostics <code class="docutils literal notranslate"><span class="pre">&lt;D&gt;</span></code> Command</a></li>
<li class="toctree-l2"><a class="reference internal" href="../accessories/suppliers.html">Hardware, Software, and Accessory Suppliers</a></li>
<li class="toctree-l2"><a class="reference internal" href="../downloads/index.html">Downloads</a><ul>
<li class="toctree-l3"><a class="reference internal" href="../downloads/documents.html">Documents</a></li>
<li class="toctree-l3"><a class="reference internal" href="../downloads/schematics.html">Schematics</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="../tools/index.html">Diagnostic Tools</a><ul>
<li class="toctree-l3"><a class="reference internal" href="../tools/diagnostic-tools.html">DCC Diagnostic Tools</a></li>
<li class="toctree-l3"><a class="reference internal" href="../tools/serial-monitor.html">Using a Serial Monitor</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="../wire-gauge.html">Wire Gauge Information</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="../../download/index.html">Software Downloads</a><ul>
<li class="toctree-l2"><a class="reference internal" href="../../download/commandstation.html">Command Station Downloads</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../download/esp8266.html">ESP8266 Files</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../download/dcc-inspector-ex.html">DCC Inspector-EX</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="../../projects/index.html">Projects</a><ul>
<li class="toctree-l2"><a class="reference internal" href="../../projects/railsnail-bluetooth.html">RailSnail’s Complete Bluetooth DCC++EX Command Station</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="../../contributing/index.html">Contributing</a><ul>
<li class="toctree-l2"><a class="reference internal" href="../../contributing/requirements.html">Requirements</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../contributing/website.html">Documentation</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../contributing/development.html">Development</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../contributing/contactus.html">Contact us</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="../../roadmap/index.html">DCC-EX Roadmap</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../support/index.html">Support</a><ul>
<li class="toctree-l2"><a class="reference internal" href="../../support/create-ticket.html">Submit a Support Ticket</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="../../site-map/index.html">Site Map</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../about/index.html">About</a><ul>
<li class="toctree-l2"><a class="reference internal" href="../../about/rewrite.html">What’s New in DCC++ EX?</a></li>
</ul>
</li>
</ul>

            
          
        </div>
        
      </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap">

      
      <nav class="wy-nav-top" aria-label="top navigation">
        
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="../../index.html">DCC++ EX</a>
        
      </nav>


      <div class="wy-nav-content">
        
        <div class="rst-content">
        
          

















<div role="navigation" aria-label="breadcrumbs navigation">

  <ul class="wy-breadcrumbs">
    
      <li><a href="../../index.html" class="icon icon-home"></a> &raquo;</li>
        
          <li><a href="../index.html">Reference</a> &raquo;</li>
        
          <li><a href="index.html">Hardware</a> &raquo;</li>
        
      <li>I2C Devices</li>
    
    
      <li class="wy-breadcrumbs-aside">
        
          
            <a href="../../_sources/reference/hardware/i2c-devices.rst.txt" rel="nofollow"> View page source</a>
          
        
      </li>
    
  </ul>

  
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
           <div itemprop="articleBody">
            
  <div class="section" id="i2c-devices">
<h1>I2C Devices<a class="headerlink" href="#i2c-devices" title="Permalink to this headline">¶</a></h1>
<p>With the advent of the Hardware Abstraction Layer (HAL), DCC++EX now has the capability for
support for new I/O devices to be added without any change to the base software.  By I/O
devices I mean the things that are controlled through Sensors, Outputs and Turnouts (and
more recently by commands in EX-RAIL too).  Motor shields are not included in the HAL at present.</p>
<p>As a consequence of this, it is much easier to write a device driver, without the risk of
breaking DCC++EX for other users.  So there are various drivers available for you to use:</p>
<ul class="simple">
<li><p>I2C-connected GPIO Expanders (MCP23017, MPC23008, PCF8574);</p></li>
<li><p>I2C-connected Servo Controller (PCA9685);</p></li>
<li><p>I2C-connected laser proximity detector (Time-of-Flight) (VL53L0X);</p></li>
<li><p>I2C-connected Analogue input modules (ADS111x);</p></li>
<li><p>Serial-port-connected DFPlayer MP3 player;</p></li>
<li><p>Ultrasound proximity detector (HC-SR04);</p></li>
</ul>
<p>and others.</p>
<p>You will have noticed that a lot of the devices above have the name I2C in their description,
so this section is an introduction to what I2C is and how to use it.</p>
<div class="section" id="what-is-i2c">
<h2>What is I2C?<a class="headerlink" href="#what-is-i2c" title="Permalink to this headline">¶</a></h2>
<p>I2C is a standard introduced by the Philips Semiconductors (now NXP Semiconductors) in the
early 1980s to provide a mechanism for
simple and economical communication between integrated circuits within a system, i.e.
Inter Integrated Circuit (or IIC, or I-squared-C; hence I2C).  The term I2C was originally
under copyright, so other manufacturers sometimes use the term Two-Wire Interface (TWI).</p>
<p>I2C uses two bus wires (and the components share a ground and usually a power wire).  One bus line is
called SCL (clock) and the other is SDA (data).  Both wires are pulled up to the power supply level (+Vcc)
through a resistor, so when inactive, the wire is HIGH state (Vcc).</p>
<p>All I2C devices are connected to both the SDA and SCL lines, so are able to see whether the lines are pulled
up (HIGH state) or pulled down (LOW state).  Any device may activate one or the other line by connecting the wire to Ground,
so that all of the other devices see a LOW state.  The data is presented on the SDA line, bit by bit, in sync with
the pulses on the SCL line.</p>
<p>The master is responsible for generating the clock signal on the SCL line, whether the Master is transmitting or the
Slave is transmitting.  Clock speeds for the Arduino are generally either 100kHz (Standard mode) or 400kHz (Fast mode).
Other speeds may be selected, but the Arduino AVR microcontroller will not operate at speeds faster than 400kHz.</p>
<p>One device on the bus is termed as the MASTER.  Only a Master device is
able to initiate communications on the bus.  The bus may also have a number of SLAVE devices.  The slave
only speaks when it is spoken to by a Master.</p>
<p><strong>Note: The I2C standard allows for multi-master buses in which two or more Master devices
may be present.  DCC++EX only has a single Master, which is the DCC++EX controller itself.</strong></p>
<p>Each Slave device has an address on the bus, which is normally 7 bits in length.  I2C addresses are generally
written in hex format, in the range 0x00 (0) to 0x7F (127).  For example, a GPIO Expander device might have
an address of 0x20, and an OLED display may be 0x3F.</p>
<p><strong>Note: The addresses in the ranges 0x00 to 0x0f and 0x78 to 0x7f are reserved, and should not be used
for devices.  Also, the I2C standard allows for 10-bit addresses, but none of the devices currently
used by DCC++EX support this.</strong></p>
<p>When the Master wants to communicate with a Slave device, it sends the address of the device it wishes
to communicate with, and a Slave device which matches that address will respond.  The Master may
then send further data which that Slave may interpret as a command.  Or the Master may wait to allow the Slave to
send data.  In this way, we can have two-way data flows from Master to Slave, and from Slave to Master.</p>
<p>For more information about I2C, including a link to the I2C Standard, see <a class="reference external" href="https://www.i2c-bus.org/">https://www.i2c-bus.org/</a>.</p>
</div>
<div class="section" id="addresses">
<h2>Addresses<a class="headerlink" href="#addresses" title="Permalink to this headline">¶</a></h2>
<p>Most I2C devices allow the address to be selected by adding or removing (or moving) jumpers.
In some cases the jumpers are fitted on selector pins on the module, and the jumpers can be readily moved
to select the address.  For example, the MCP23017 can have address 0x20, 0x21, 0x22, … up to 0x27, by three jumpers.
The PCA9685 has a whopping six jumpers, allowing the address to be selected from 0x40 up to 0x7F (although addresses 0x78 to 0x7F
should not generally be used).
Some modules, like the PCA9685, use solder jumpers, which are pairs of pads on the PCB that have to be bridged by a solder blob.
OLED Display modules typically have only one pair of solder pads which allow the address
to be selected to 0x3E or 0x3F (default 0x3F).</p>
<p>The image below shows a PCF8574 module, which has three yellow jumpers labelled A0-A2,
currently shown in the right-hand position marked ‘–’ (=OFF).  This means the address is set
to 0x20.  If we move all three jumpers to the left-hand position (‘+’=ON), then the address
will be 0x27.</p>
<a class="reference internal image-reference" href="../../_images/pcf8574.jpg"><img alt="PCF8574 GPIO Expander Module" src="../../_images/pcf8574.jpg" style="width: 261.59999999999997px; height: 90.6px;" /></a>
<p><strong>Figure 1</strong> - PCF8574 GPIO Expander Module</p>
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span>Address/Jumper Settings for GPIO Expander (base=0x20)
+=========+=====+=====+=====+
| Address | A2  | A1  | A0  |
+=========+=====+=====+=====+
| 0x20    | OFF | OFF | OFF |
| 0x21    | OFF | OFF | ON  |
| 0x22    | OFF | ON  | OFF |
| 0x23    | OFF | ON  | ON  |
| 0x24    | ON  | OFF | OFF |
| 0x25    | ON  | OFF | ON  |
| 0x26    | ON  | ON  | OFF |
| 0x27    | ON  | ON  | ON  |
+=========+=====+=====+=====+
</pre></div>
</div>
<p><strong>Table 1</strong> - I2C Address Setting Examples</p>
<p>The same address settings apply for the MCP23017 and MCP23008 devices, which also have three address jumpers A2-A0 and use the
same address range 0x20-0x27.</p>
<p>One device notably uses software to configure the I2C address - the VL53L01 Time-Of-Flight sensor.  It is pre-programmed
with an address of 0x29, which you may use if you only have one TOF device.  But if you have two or more devices, then at least one
of them has to be programmed with a different address.  This is achieved through an additional wire per module, connected to the
module’s XSHUT pin. By operating the XSHUT pins, the device driver is able to programme one device at a time, while the remaining
unprogrammed devices are held in the ‘shutdown’ state.  So each device can use any I2C address!</p>
</div>
<div class="section" id="connector-styles">
<h2>Connector Styles<a class="headerlink" href="#connector-styles" title="Permalink to this headline">¶</a></h2>
<p>Many I2C devices come with a set of four pins, spaced by 2.5mm, for you to connect to.  In some
cases, the pins come separately and need to be soldered.  If you’re not happy with soldering,
then check before buying.</p>
<p>A common type of connector is the <em>DuPont</em> connectors, which are spaced by 2.5mm.  They come in female form, which fits over a standard pin header,
and male form, which fits into a connector block such as found on the Arduino boards.  They come in the form of a length of ribbon cable (in standard lengths of 5cm, 10cm, 15cm and others)
with each wire pre-fitted at both ends with either a female or male DuPont connector.</p>
<p>You can also purchase kits of Dupont pins/sockets and shells which,
with the aid of a crimping tool, and a bit of practice, will enable you to make your own custom connectors.</p>
<p>Some devices (particularly from SeeedStudio, but some other manufacturers too) use
a four-pin <em>Grove</em> male connector which takes a specific female connector, also manufactured and marketed by SeeedStudio.  The pins in the
Grove connector are on a spacing of 2.0mm, so will not directly the 2.5mm connector pins on most I2C device.  However, converter cables are available
with a Grove connector on one end and Dupont connectors on the other.</p>
<p>I find the JST-XH connectors to be very good; they are 2.5mm pitch so fit directly
onto standard pin headers, and provide a more positive connection than the Dupont
connectors.  Again, they are available in kit form for crimping onto ribbon cables,
or they can be found in pre-assembled form.  Note that, while they look very much like the Grove connectors,
they are a different size and are not interchangeable.</p>
<a class="reference internal image-reference" href="../../_images/connectors.jpg"><img alt="JST-XH, Dupont, and Grove connectors" src="../../_images/connectors.jpg" style="width: 512.0px; height: 384.0px;" /></a>
<p><strong>Figure 2</strong> - From left-to-right, JST-XH connectors, Dupont connector shells, Dupont cable, and Grove converter cable.</p>
</div>
<div class="section" id="connecting-devices">
<h2>Connecting Devices<a class="headerlink" href="#connecting-devices" title="Permalink to this headline">¶</a></h2>
<p>The position of the I2C pins depends on what controller module you are using:</p>
<ul class="simple">
<li><p>On the Arduino Nano, the I2C pins are labelled A4 (SDA) and A5 (SCL).</p></li>
<li><p>On the Arduino Mega, they are pins D20 (SDA) and D21 (SCL), which are nearest to the reset button.</p></li>
<li><p>On the Arduino Uno, you may use pins A4 (SDA) and A5 (SCL), or pins D20 (SDA) and D21 (SCL), which are in the same place as on the Mega.
Bear in mind that, even if you use pins D20 and D21 for I2C, the pins A4 and A5 cannot be used for analogue inputs.</p></li>
</ul>
<a class="reference internal image-reference" href="../../_images/mega_i2cpins.png"><img alt="Arduino Mega/Uno I2C pins" src="../../_images/mega_i2cpins.png" style="width: 527.2px; height: 243.20000000000002px;" /></a>
<p><strong>Figure 3</strong> - Arduino Mega/Uno I2C pins</p>
<p>Some motor shields come with header pins for the I2C connections, for example the Arduino motor shield and
the DeekRobot equivalent.  The header pins are labelled, and are ringed in the images below.</p>
<a class="reference internal image-reference" href="../../_images/deek_robot.jpg"><img alt="Motor shield I2C pins" src="../../_images/deek_robot.jpg" style="width: 400.0px; height: 400.0px;" /></a>
<p><strong>Figure 4</strong> - Motor Shield I2C pins</p>
<p>The next image shows an Arduino Mega and Deekrobot motor shield mounted in a 3D-printed 6-inch rack case, with
one set of I2C pins connected to an OLED display on the front of the case, and one set of I2C pins connected to two external connectors at the
rear of the case.  The orange wires connect four LEDs (with current-limiting series resistors) that provide panel indications of incoming
5V and 14V power, and of outgoing DCC power to the Main and Programming tracks.  I’ve also mounted a small self-adhesive aluminium
heat sink onto the L298P device.</p>
<a class="reference internal image-reference" href="../../_images/deekrobot_motor_shield.jpg"><img alt="Motor shield I2C pins" src="../../_images/deekrobot_motor_shield.jpg" style="width: 300.8px; height: 272.8px;" /></a>
<p><strong>Figure 5</strong> - Motor Shield I2C pins</p>
<p>I2C devices are all effectively connected in parallel to the bus.  If you only
have one device, you can just run a four-wire connecter between the pins on the Arduino, or on
the motor shield, if you have one, to the device.  Be sure to check that you connect SDA to SDA,
SCL to SCL, Vcc to Vcc and GND to GND though - they are almost always in a different order on each
device!</p>
<a class="reference internal image-reference" href="../../_images/ArduinoMegaOLED.png"><img alt="Arduino Mega with OLED Display" src="../../_images/ArduinoMegaOLED.png" style="width: 451.8px; height: 295.2px;" /></a>
<p><strong>Figure 6</strong> - Connecting an OLED Display to an Arduino Mega</p>
<a class="reference internal image-reference" href="../../_images/ArduinoMegaServo.png"><img alt="Arduino Mega with one servo controllers" src="../../_images/ArduinoMegaServo.png" style="width: 555.3px; height: 370.8px;" /></a>
<p><strong>Figure 7</strong> - Connecting a PCA9685 Servo Controller to an Arduino Mega</p>
<p>If you have more than one device, then there are a few options open to you.  Some modules
(PCA9685 and PCF8574 for example) have I2C pins at both ends of the PCB, so you can use one
set of pins to connect to the Arduino and the other set to connect to another device.  You
can chain multiple devices, subject to the restrictions described in sections for Cabling and Pull-ups.</p>
<a class="reference internal image-reference" href="../../_images/ArduinoMega2xServo.png"><img alt="Arduino Mega with two servo controllers" src="../../_images/ArduinoMega2xServo.png" style="width: 661.5px; height: 409.5px;" /></a>
<p><strong>Figure 8</strong> - Connecting Two Servo Controllers</p>
<p>Alternatively, you can use an I2C hub, which you can purchase
(<a class="reference external" href="https://www.seeedstudio.com/Grove-I2C-Hub.html">SeeedStudio do one</a>, but check
that you have compatible connectors - it uses Grove connectors); or you can make one.  You can use a breadboard
with jumpers, or a stripboard with 4 rows of pins.  Just ensure that the strips separately connect
all the SCL pins together, all the SDA together, all the Vcc together and all the GND together.  SeeedStudio also
sell 4-wire cables with three connectors (also Grove), allowing a single connector to ‘fan out’ to two devices; by connecting another
cable, you can add another device, and so on.</p>
<p>I use a small piece of stripboard with various 4-way pin headers and sockets soldered in, to allow various devices
to be plugged in and removed as required.  There is a mixture of pin headers and sockets (which accept Dupont cables)
and JST-XH male sockets (which accept female cable connectors, or female Dupont connectors.
I also have a four-way socket header connected in parallel, into which
an OLED display is fitted for testing.</p>
<a class="reference internal image-reference" href="../../_images/i2chub.jpg"><img alt="Home-brew I2C Passive Hub" src="../../_images/i2chub.jpg" style="width: 384.0px; height: 288.0px;" /></a>
<p><strong>Figure 9</strong> - Home-brew I2C Hub, on Vero Stripboard (strips running left-to-right)</p>
<p>If you just want a temporary hookup for multiple I2C devices, then you can use a small piece of breadboard.
The board shown has space for five Dupont connectors in each half row.</p>
<a class="reference internal image-reference" href="../../_images/breadboard-hub.jpg"><img alt="Bread-board based I2C Passive Hub" src="../../_images/breadboard-hub.jpg" style="width: 512.0px; height: 384.0px;" /></a>
<p><strong>Figure 10</strong> - I2C Hub on Breadboard</p>
</div>
<div class="section" id="pull-ups">
<h2>Pull-ups<a class="headerlink" href="#pull-ups" title="Permalink to this headline">¶</a></h2>
<p>The I2C bus will not work unless pull-up resistors are connected to the SDA and SCL lines.  However,
it’s not very often that you will have to install your own pull-up resistors.  Most microcontrollers
have the capability to enable internal pull-ups, corresponding to around 20-50kOhm.
And most I2C device modules (<em>but not the bare I2C chips</em>), contain 10kOhm pullup resistors.</p>
<p>The ideal pull-up resistor value for I2C is around 1.7kOhm (at 5V, 400kHz clock), in order to be able
to use long cables and high speeds.  With shorter cables (&lt;1-2m) an internal or module pull-up will
generally be sufficient.</p>
<p>However, if you have multiple I2C modules, the pull-up resistors in them will be effectively in parallel.
So two modules give an equivalent pull-up of 5kOhm, and five modules gives an equivalent pull-up of 2kOhm. With 6 or more modules,
the pull-up value is, strictly, too low, and some devices, if they only just satisfy the I2C specification,
may be unable to pull the bus voltage down far enough to be recognised as a LOW state.
In this case, you may need to seek solutions like removing the pull-up resistors from some or all of the modules,
and/or adding your own fixed pull-up.  Or adding an I2C multipexer, which will disconnect some devices from the SCL/SDA lines when they
are not being actively addressed.</p>
</div>
<div class="section" id="removal-of-pull-ups">
<h2>Removal of Pull-ups<a class="headerlink" href="#removal-of-pull-ups" title="Permalink to this headline">¶</a></h2>
<p>If you want to remove the pull-ups from your modules and add your own (single) pull-up resistor to the I2C bus, then the first
thing to do is identify which components on the module PCB are the pull-up resistors.  Many modules have full documentation available
(including circuit diagram and PCB layout), which will help to identify the pull-ups.  Check the web sites for the suppliers.</p>
<p>As examples of where to find the pull-up resistors, take a look at the figures below:</p>
<a class="reference internal image-reference" href="../../_images/pca9685_pullups.jpg"><img alt="PCA9685 pullup resistors" src="../../_images/pca9685_pullups.jpg" style="width: 329.09999999999997px; height: 133.2px;" /></a>
<p><strong>Figure 11</strong> - Location of Pull-up Resistors for PCA9685 Module (ringed in red)</p>
<a class="reference internal image-reference" href="../../_images/pcf8574_pullups.jpg"><img alt="PCF8574 pullup resistors" src="../../_images/pcf8574_pullups.jpg" style="width: 436.0px; height: 151.0px;" /></a>
<p><strong>Figure 12</strong> - Location of Pull-up Resistors for PCF8574 Module (ringed in red)</p>
<p>Check the PCB tracks from the SDA and SCL pin connectors; one side of each resistors will be connected to one of these,
and the other side of both will be connected to the Vcc supply.</p>
<p><strong>IMPORTANT:  When you desolder the resistors, ensure that you don’t leave any residual
solder forming a connection between the two pads.</strong></p>
</div>
<div class="section" id="cabling-limits">
<h2>Cabling Limits<a class="headerlink" href="#cabling-limits" title="Permalink to this headline">¶</a></h2>
<p>The I2C bus spec allows bus operation at various speeds - on the Arduino, speeds of 100kHz and 400kHz are
generally used.  Some devices are not specified to operate at the higher speed (e.g. PCF8574) although
my testing hasn’t shown any problems.</p>
<p>The number of devices and the amount of cable on an I2C bus is limited, in the I2C specification, only by the
total capacitance, which at 400kHz should be no more than 400pF.  At this capacitance and the optimal
pull-up value, the time taken for the bus wire to be pulled up from LOW to HIGH state is significant, compared to the pulse length.
With a higher pull-up value (e.g. 10kOhm), the maximum permitted capacitance will be lower.
If you need to run with higher capacitance (e.g. for longer cables), then it is possible to reduce the I2C
clock speed.  On DCC++EX, operation will continue even with I2C speeds of 32kHz or lower, although the
scan interval for digital inputs, and the refresh time for I2C displays, may be noticably slower at speeds
lower than 32kHz.</p>
</div>
<div class="section" id="changing-the-clock-speed">
<h2>Changing the Clock speed<a class="headerlink" href="#changing-the-clock-speed" title="Permalink to this headline">¶</a></h2>
<p>In DCC++EX the I2C clock speed is normally the highest speed supported by all configured devices.
It may however be overridden within the mySetup.h or myHal.cpp file, with a command of the form:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">I2CManager</span><span class="o">.</span><span class="n">forceClock</span><span class="p">(</span><span class="mi">100000</span><span class="p">);</span>
</pre></div>
</div>
<p>(this sets the clock speed to 100kHz.)</p>
</div>
</div>


           </div>
           
          </div>
          <footer>
    <div class="rst-footer-buttons" role="navigation" aria-label="footer navigation">
        <a href="gpio-module.html" class="btn btn-neutral float-right" title="I2C GPIO Expander Modules" accesskey="n" rel="next">Next <span class="fa fa-arrow-circle-right" aria-hidden="true"></span></a>
        <a href="i2c-displays.html" class="btn btn-neutral float-left" title="I2C Displays" accesskey="p" rel="prev"><span class="fa fa-arrow-circle-left" aria-hidden="true"></span> Previous</a>
    </div>

  <hr/>

  <div role="contentinfo">
    <p>
        &#169; Copyright 2020, 2021 - Fred Decker, Mani Kumar.

    </p>
  </div>
    
    
    
    Built with <a href="https://www.sphinx-doc.org/">Sphinx</a> using a
    
    <a href="https://github.com/readthedocs/sphinx_rtd_theme">theme</a>
    
    provided by <a href="https://readthedocs.org">Read the Docs</a>. 

</footer>
        </div>
      </div>

    </section>

  </div>
  

  <script type="text/javascript">
      jQuery(function () {
          SphinxRtdTheme.Navigation.enable(true);
      });
  </script>

  
  
    
   

</body>
</html>