

<!DOCTYPE html>
<html class="writer-html5" lang="en" >
<head>
  <meta charset="utf-8" />
  
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  
  <title>Diagnostics &lt;D ACK&gt; Command &mdash; DCC++ EX  documentation</title>
  

  
  <link rel="stylesheet" href="../../_static/css/theme.css" type="text/css" />
  <link rel="stylesheet" href="../../_static/pygments.css" type="text/css" />
  <link rel="stylesheet" href="../../_static/css/dccex_theme.css" type="text/css" />

  
  

  
  

  

  
  <!--[if lt IE 9]>
    <script src="../../_static/js/html5shiv.min.js"></script>
  <![endif]-->
  
    
      <script type="text/javascript" id="documentation_options" data-url_root="../../" src="../../_static/documentation_options.js"></script>
        <script src="../../_static/jquery.js"></script>
        <script src="../../_static/underscore.js"></script>
        <script src="../../_static/doctools.js"></script>
        <script src="../../_static/js/platform.js"></script>
        <script src="../../_static/js/extra.js"></script>
    
    <script type="text/javascript" src="../../_static/js/theme.js"></script>

    
    <link rel="index" title="Index" href="../../genindex.html" />
    <link rel="search" title="Search" href="../../search.html" />
    <link rel="next" title="Diagnostics &lt;D&gt; Command" href="diagnostic-d-command.html" />
    <link rel="prev" title="DCC++ EX Command Reference" href="command-reference.html" /> 
</head>

<body class="wy-body-for-nav">

   
  <div class="wy-grid-for-nav">
    
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-scroll">
        <div class="wy-side-nav-search"  style="background: white" >
          

          
            <a href="../../index.html">
          

          
            
            <img src="../../_static/logo.png" class="logo" alt="Logo"/>
          
          </a>

          
            
            
          

          
<div role="search">
  <form id="rtd-search-form" class="wy-form" action="../../search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" />
    <input type="hidden" name="check_keywords" value="yes" />
    <input type="hidden" name="area" value="default" />
  </form>
</div>

          
        </div>

        
        <div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="main navigation">
          
            
            
              
            
            
              <ul class="current">
<li class="toctree-l1"><a class="reference internal" href="../../get-started/index.html">Get Started</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../advanced-setup/index.html">Advanced Setup</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../throttles/index.html">Throttles</a></li>
<li class="toctree-l1 current"><a class="reference internal" href="../index.html">Reference</a><ul class="current">
<li class="toctree-l2"><a class="reference internal" href="../hardware/microcontroller-boards.html">Microcontroller Boards</a></li>
<li class="toctree-l2"><a class="reference internal" href="../hardware/motor-boards.html">Motor Boards</a></li>
<li class="toctree-l2"><a class="reference internal" href="../hardware/wifi-boards.html">WiFi Boards</a></li>
<li class="toctree-l2"><a class="reference internal" href="../hardware/ethernet-boards.html">Ethernet Boards</a></li>
<li class="toctree-l2"><a class="reference internal" href="../hardware/i2c-displays.html">I2C Displays</a></li>
<li class="toctree-l2"><a class="reference internal" href="../hardware/power-supplies.html">Power Supplies</a></li>
<li class="toctree-l2"><a class="reference internal" href="../hardware/shopping-list.html">Shopping List</a></li>
<li class="toctree-l2"><a class="reference internal" href="release-notes.html">Release Notes</a></li>
<li class="toctree-l2"><a class="reference internal" href="command-reference.html">DCC++ EX Command Reference</a></li>
<li class="toctree-l2 current"><a class="current reference internal" href="#">Diagnostics <code class="docutils literal notranslate"><span class="pre">&lt;D</span> <span class="pre">ACK&gt;</span></code> Command</a></li>
<li class="toctree-l2"><a class="reference internal" href="diagnostic-d-command.html">Diagnostics <code class="docutils literal notranslate"><span class="pre">&lt;D&gt;</span></code> Command</a></li>
<li class="toctree-l2"><a class="reference internal" href="../accessories/suppliers.html">Hardware, Software, and Accessory Suppliers</a></li>
<li class="toctree-l2"><a class="reference internal" href="../documents/decoder-table.html">Stationary Decoder Address Table</a></li>
<li class="toctree-l2"><a class="reference internal" href="../documents/wire-gauge.html">Wire Gauge Information</a></li>
<li class="toctree-l2"><a class="reference internal" href="../tools/diagnostic-tools.html">DCC Diagnostic Tools</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="../../download/index.html">Downloads</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../projects/index.html">Projects</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../contributing/index.html">Contributing</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../support/index.html">Support</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../about/index.html">About</a></li>
</ul>

            
          
        </div>
        
      </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap">

      
      <nav class="wy-nav-top" aria-label="top navigation">
        
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="../../index.html">DCC++ EX</a>
        
      </nav>


      <div class="wy-nav-content">
        
        <div class="rst-content">
        
          

















<div role="navigation" aria-label="breadcrumbs navigation">

  <ul class="wy-breadcrumbs">
    
      <li><a href="../../index.html" class="icon icon-home"></a> &raquo;</li>
        
          <li><a href="../index.html">Reference</a> &raquo;</li>
        
      <li>Diagnostics <code class="docutils literal notranslate"><span class="pre">&lt;D</span> <span class="pre">ACK&gt;</span></code> Command</li>
    
    
      <li class="wy-breadcrumbs-aside">
        
          
            <a href="../../_sources/reference/software/diagnostic-d-ack-command.rst.txt" rel="nofollow"> View page source</a>
          
        
      </li>
    
  </ul>

  
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
           <div itemprop="articleBody">
            
  <div class="section" id="diagnostics-d-ack-command">
<h1>Diagnostics <code class="docutils literal notranslate"><span class="pre">&lt;D</span> <span class="pre">ACK&gt;</span></code> Command<a class="headerlink" href="#diagnostics-d-ack-command" title="Permalink to this headline">¶</a></h1>
<p>If you encounter problems with ACKs from the Decoder (Reading or Writing CVs) and you want help, the DCC-EX support team will ask you to provide a log. This is a very simple diagnostic test to provide us with the proper information. With your loco on the PROG track, and using a serial monitor like the one in the Arduino IDE, enter each of these two commands folowed by pressing “send”:</p>
<div class="line-block">
<div class="line"><code class="docutils literal notranslate"><span class="pre">&lt;D</span> <span class="pre">ACK</span> <span class="pre">ON&gt;</span></code></div>
<div class="line"><code class="docutils literal notranslate"><span class="pre">&lt;R&gt;</span></code></div>
</div>
<p>This will turn ACK diagnostics ON and then try to read the appropriate CVs to determine your loco address. If you don’t see your loco address at the end of the report, send us the log (see below for an example), and we can help you diagnose the problem.</p>
<div class="section" id="more-detail">
<h2>More Detail<a class="headerlink" href="#more-detail" title="Permalink to this headline">¶</a></h2>
<p>When the ACK processing on the prog track does not work as expected, you may want to use the <code class="docutils literal notranslate"><span class="pre">&lt;D</span> <span class="pre">ACK</span> <span class="pre">ON&gt;</span></code> command in a serial command window. This is an example how to read CV8 with diagnostics on. You enter the first 2 lines, <code class="docutils literal notranslate"><span class="pre">&lt;D</span> <span class="pre">ACK</span> <span class="pre">ON&gt;</span></code> followed by <code class="docutils literal notranslate"><span class="pre">send</span></code>, then <code class="docutils literal notranslate"><span class="pre">&lt;R</span> <span class="pre">8</span> <span class="pre">1</span> <span class="pre">1&gt;</span></code> followed by <code class="docutils literal notranslate"><span class="pre">send</span></code>. DCC-EX does not echo what you write, but your serial command window may. With diag on you get the extra 11 lines of output compared to if you just entered the command with diagnostics off. The last line is the answer, CV8=145:</p>
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span>&lt;D ACK ON&gt;
&lt;R 8 1 1&gt;
ACK-BASELINE 33/98mA
V0 cv=8 bit=7 NO-ACK after 143mS max=12/35mA pulse=0uS
V1 cv=8 bit=7 ACK-OK after 34mS max=646/1931mA pulse=6852uS
V0 cv=8 bit=6 ACK-OK after 34mS max=583/1743mA pulse=6844uS
V0 cv=8 bit=5 ACK-OK after 34mS max=646/1931mA pulse=6800uS
V0 cv=8 bit=4 NO-ACK after 144mS max=12/35mA pulse=0uS
V0 cv=8 bit=3 ACK-OK after 34mS max=563/1683mA pulse=6792uS
V0 cv=8 bit=2 ACK-OK after 34mS max=647/1934mA pulse=6800uS
V0 cv=8 bit=1 ACK-OK after 34mS max=573/1713mA pulse=6844uS
V0 cv=8 bit=0 NO-ACK after 145mS max=14/41mA pulse=0uS
VB cv=8 value=145 ACK-OK after 34mS max=639/1910mA pulse=6848uS
Callback(145)
&lt;r1|1|8 145&gt;
</pre></div>
</div>
<p>Your output may show different formatting with respect to linefeeds. Here the decoder reports that bits 7, 4 and 0 are <strong>NOT</strong> Zero. That gives the value of <code class="docutils literal notranslate"><span class="pre">10010001</span> <span class="pre">=</span> <span class="pre">145</span></code> which is the manufacturer ID for Zimo. That value is checked in the <code class="docutils literal notranslate"><span class="pre">VB</span></code> line. For a successful read, the result of the verify bit and verify byte commands have to match, otherwise the value can not be read. If you have problems reading decoders, you can compare the received values with the expected values. The format is:</p>
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span>OPERATION cv=n bit=b NO-ACK/OK after WAITTIME mS max=INTERNALVAL / CURRENT mA pulse= PULSELENGTH uS
</pre></div>
</div>
<p>The CURRENT should be over 60mA for a successful ACK and the length should be 6000uS +-1000uS but because of Decoder variations from the standard, DCC-EX has some extra pulse length margin.</p>
<p>In this example, we are checking CV 8, which is the manufacturer ID for your decoder. We then check each of the 8 “bits” in the “byte” that holds the value in that CV.</p>
<p>The first test, <code class="docutils literal notranslate"><span class="pre">ACK-BASELINE</span></code> gets a baseline reading of the current on your programming track with the loco just sitting there.</p>
<p>Since most bits will be 0, we check that first to save time. <code class="docutils literal notranslate"><span class="pre">V0</span></code> means <code class="docutils literal notranslate"><span class="pre">Verify</span> <span class="pre">zero</span></code>. If do not get a zero, we then try to verify a 1 - <code class="docutils literal notranslate"><span class="pre">V1</span></code> means “Verify one”. If we don’t get either, we display an error. A bit must be either a 0 or a 1 so the test will fail, but the data returned can help us see why.</p>
<p>If we succeed on the first bit, we check each of the remaining 7 bits. <code class="docutils literal notranslate"><span class="pre">NO-ACK</span></code> means we did not see the bit value we were testing for, <code class="docutils literal notranslate"><span class="pre">ACK-OK</span></code> tells us we received an ACK. After each bit test, we show how long it took to receive the ACK (or the timeout value if we detected none), the Arduino raw pin reading being sent by your motor controller’s current sense circuit, and what that translates to in milliAmps. Finally, we report the duration of the ACK Pulse, if detected.</p>
<p>We do one final test at the end to <code class="docutils literal notranslate"><span class="pre">Verify</span> <span class="pre">Byte</span></code>, you see that as <code class="docutils literal notranslate"><span class="pre">VB</span></code>. This does a double-check to see if the byte contains what we found by checking it one bit at a time. The must match for a successful read.</p>
<p>Other than when using the “decoder address test”, <code class="docutils literal notranslate"><span class="pre">&lt;R&gt;</span></code> with no parameters, you need to enter CV read commands with all 3 parameters. The format is <code class="docutils literal notranslate"><span class="pre">&lt;R</span> <span class="pre">CV</span> <span class="pre">x</span> <span class="pre">y&gt;</span></code> where R stands for read and CV is the CV number you want to check. The X and Y values can be anything, but must be entered. They are an advanced feature for programmers whose software can work with DCC-EX (like JMRI). So you would enter <code class="docutils literal notranslate"><span class="pre">&lt;R</span> <span class="pre">8</span> <span class="pre">55</span> <span class="pre">55&gt;</span></code> or <code class="docutils literal notranslate"><span class="pre">R</span> <span class="pre">8</span> <span class="pre">1</span> <span class="pre">1&gt;</span></code> to try and read CV 8. The response is <code class="docutils literal notranslate"><span class="pre">&lt;r</span> <span class="pre">CV</span> <span class="pre">x</span> <span class="pre">y&gt;</span></code> where “x” and “y” are whatever numbers you entered after the CV value.</p>
<p>To turn off the ack diagnoistics use any parameter that is not “ON” or “LIMIT”.</p>
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span>&lt;D ACK NOPE&gt;
</pre></div>
</div>
<p>Diag messages off.</p>
</div>
<div class="section" id="ack-limit">
<h2>Ack Limit<a class="headerlink" href="#ack-limit" title="Permalink to this headline">¶</a></h2>
<p>The Ack current limit is set according to the DCC standard(s) of 60mA. Most decoders send a quick back and forth current pulse to the motor to generate this ACK. However, some modern motors (N and Z scales) may not be able to draw that amount of current. You can adjust down this limit. Or, if for some reasons your acks seem to be too “trigger happy” you can make it less sensitive by raising this limit.</p>
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span>&lt;D ACK LIMIT 30&gt;
</pre></div>
</div>
<p>would set the ack limit to 30mA (more sensitive).</p>
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span>&lt;D ACK LIMIT 100&gt;
</pre></div>
</div>
<p>would set the limit to 100mA (less sensitive).</p>
<p>The custom ack limit will be effective until you restart the Command Station (it will not “stick” in EEPROM). If you wish to permanenly set the ACK LIMIT, you may enter it as a command in the setup.h file.</p>
<p><strong>*Add help on how to set this in the autoexec file*</strong></p>
</div>
</div>


           </div>
           
          </div>
          <footer>
    <div class="rst-footer-buttons" role="navigation" aria-label="footer navigation">
        <a href="diagnostic-d-command.html" class="btn btn-neutral float-right" title="Diagnostics &lt;D&gt; Command" accesskey="n" rel="next">Next <span class="fa fa-arrow-circle-right" aria-hidden="true"></span></a>
        <a href="command-reference.html" class="btn btn-neutral float-left" title="DCC++ EX Command Reference" accesskey="p" rel="prev"><span class="fa fa-arrow-circle-left" aria-hidden="true"></span> Previous</a>
    </div>

  <hr/>

  <div role="contentinfo">
    <p>
        &#169; Copyright 2020, Dave Cutting, Fred Decker, Mani Kumar, Matt H.

    </p>
  </div>
    
    
    
    Built with <a href="https://www.sphinx-doc.org/">Sphinx</a> using a
    
    <a href="https://github.com/readthedocs/sphinx_rtd_theme">theme</a>
    
    provided by <a href="https://readthedocs.org">Read the Docs</a>. 

</footer>
        </div>
      </div>

    </section>

  </div>
  

  <script type="text/javascript">
      jQuery(function () {
          SphinxRtdTheme.Navigation.enable(true);
      });
  </script>

  
  
    
   

</body>
</html>